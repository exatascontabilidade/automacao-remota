<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Disparar Rob√¥</title>
</head>
<body>
  <h1>üöÄ Disparar Rob√¥ Remotamente</h1>
  <button onclick="disparar()">Executar Rob√¥</button>
  <p id="status"></p>

  <script>
    async function disparar() {
      const token = "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";  // ‚ö†Ô∏è vis√≠vel no frontend, n√£o usar em produ√ß√£o
      const repo = "exatascontabilidade/automacao-remota";
      const file = "comando.json";
      const url = `https://api.github.com/repos/${repo}/contents/${file}`;

      try {
        // Passo 1 ‚Äì Obter SHA atual
        const getRes = await fetch(url, {
          headers: { Authorization: `Bearer ${token}` }
        });

        if (!getRes.ok) {
          document.getElementById("status").innerText = "‚ùå Erro ao buscar SHA.";
          console.error("Erro ao obter SHA:", await getRes.text());
          return;
        }

        const fileData = await getRes.json();
        const sha = fileData.sha;

        // Passo 2 ‚Äì Gerar novo conte√∫do em base64
        const novoConteudo = btoa(JSON.stringify({ executar: true }));

        // Passo 3 ‚Äì Atualizar o comando.json
        const updateRes = await fetch(url, {
          method: "PUT",
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "üöÄ Atualizar comando.json para executar",
            content: novoConteudo,
            sha: sha
          })
        });

        if (updateRes.ok) {
          document.getElementById("status").innerText = "‚úÖ Comando enviado!";
        } else {
          document.getElementById("status").innerText = "‚ùå Erro ao enviar comando.";
          console.error("Erro ao atualizar comando:", await updateRes.text());
        }
      } catch (error) {
        document.getElementById("status").innerText = "‚ùå Erro inesperado.";
        console.error("Erro geral:", error);
      }
    }
  </script>
</body>
</html>
